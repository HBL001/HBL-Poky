Upstream-Status: Inappropriate [oe specific] 
From 3745caaf2b5bb0cf408e7d8f1403e8f51d2773eb Mon Sep 17 00:00:00 2001
From: Richard Day <richard_day@highlandbiosciences.com>
Date: Fri, 2 May 2025 23:02:53 +0100
Subject: [PATCH] custom-hardware

---
 .../arm/boot/dts/ti/omap/am335x-boneblack.dts | 129 +++++++++++++++---
 1 file changed, 112 insertions(+), 17 deletions(-)

diff --git a/arch/arm/boot/dts/ti/omap/am335x-boneblack.dts b/arch/arm/boot/dts/ti/omap/am335x-boneblack.dts
index 16b567e3cb47..a0d3193d029d 100644
--- a/arch/arm/boot/dts/ti/omap/am335x-boneblack.dts
+++ b/arch/arm/boot/dts/ti/omap/am335x-boneblack.dts
@@ -7,7 +7,7 @@
 #include "am33xx.dtsi"
 #include "am335x-bone-common.dtsi"
 #include "am335x-boneblack-common.dtsi"
-#include "am335x-boneblack-hdmi.dtsi"
+ 
 
 / {
 	model = "TI AM335x BeagleBone Black";
@@ -106,26 +106,26 @@ &gpio2 {
 		"P8_8",
 		"P8_10",
 		"P8_9",
-		"P8_45 [hdmi]",
-		"P8_46 [hdmi]",
-		"P8_43 [hdmi]",
-		"P8_44 [hdmi]",
-		"P8_41 [hdmi]",
-		"P8_42 [hdmi]",
-		"P8_39 [hdmi]",
-		"P8_40 [hdmi]",
-		"P8_37 [hdmi]",
-		"P8_38 [hdmi]",
-		"P8_36 [hdmi]",
-		"P8_34 [hdmi]",
+		"P8_45",
+		"P8_46",
+		"P8_43",
+		"P8_44",
+		"P8_41",
+		"P8_42",
+		"P8_39",
+		"P8_40",
+		"P8_37",
+		"P8_38",
+		"P8_36",
+		"P8_34",
 		"[rmii1_rxd3]",
 		"[rmii1_rxd2]",
 		"[rmii1_rxd1]",
 		"[rmii1_rxd0]",
-		"P8_27 [hdmi]",
-		"P8_29 [hdmi]",
-		"P8_28 [hdmi]",
-		"P8_30 [hdmi]",
+		"P8_27",
+		"P8_29",
+		"P8_28",
+		"P8_30",
 		"[mmc0_dat3]",
 		"[mmc0_dat2]",
 		"[mmc0_dat1]",
@@ -173,3 +173,98 @@ &gpio3 {
 &baseboard_eeprom {
 	vcc-supply = <&ldo4_reg>;
 };
+
+&mmc1 {
+    /* flip the cd line to ACTIVE_HIGH so the card can be detected */
+    cd-gpios = <&gpio0 6 GPIO_ACTIVE_HIGH>;
+};
+
+&am33xx_pinmux {
+    /* SPI0 for FT800 */
+    spi0_pins: spi0_pins {
+        pinctrl-single,pins = <
+            AM33XX_PADCONF(AM335X_PIN_SPI0_SCLK,  PIN_INPUT_PULLUP,  MUX_MODE0) /* P9_22 */
+            AM33XX_PADCONF(AM335X_PIN_SPI0_D0,    PIN_INPUT_PULLUP,  MUX_MODE0) /* P9_21 */
+            AM33XX_PADCONF(AM335X_PIN_SPI0_D1,    PIN_OUTPUT_PULLUP, MUX_MODE0) /* P9_18 */
+            AM33XX_PADCONF(AM335X_PIN_SPI0_CS0,   PIN_OUTPUT_PULLUP, MUX_MODE0) /* P9_17 */
+        >;
+    };
+
+    /* IÂ²C1 on P9_26/P9_24 */
+    i2c1_pins: pinmux_i2c1_pins {
+        pinctrl-single,pins = <
+            AM33XX_PADCONF(AM335X_PIN_UART1_RXD,  PIN_INPUT_PULLUP,  MUX_MODE3) /* SDA */
+            AM33XX_PADCONF(AM335X_PIN_UART1_TXD,  PIN_INPUT_PULLUP,  MUX_MODE3) /* SCL */
+        >;
+    };
+
+    /* DS1302 GPIO-bitbang RTC */
+    ds1302_pins: pinmux_ds1302 {
+        pinctrl-single,pins = <
+            AM33XX_PADCONF(AM335X_PIN_GPIO2_2,   PIN_INPUT_PULLUP,  MUX_MODE7) /* CE */
+            AM33XX_PADCONF(AM335X_PIN_GPIO2_3,   PIN_INPUT_PULLUP,  MUX_MODE7) /* SCLK */
+            AM33XX_PADCONF(AM335X_PIN_GPIO2_4,   PIN_INPUT_PULLUP,  MUX_MODE7) /* IO */
+        >;
+    };
+
+    /* BBB UART5 on LCDC_DATA8/9 for console */
+    bb_uart5_pins: pinmux_bb_uart5_pins {
+        pinctrl-single,pins = <
+            AM33XX_PADCONF(AM335X_PIN_LCD_DATA8, PIN_OUTPUT | PULL_DISABLE, MUX_MODE4) /* TXD */
+            AM33XX_PADCONF(AM335X_PIN_LCD_DATA9, PIN_INPUT  | PULL_DISABLE, MUX_MODE4) /* RXD */
+        >;
+    };
+};
+
+&spi0 {
+    	status = "okay";
+    	pinctrl-names = "default";
+    	pinctrl-0     = <&spi0_pins>;
+
+    ft800: ft800@0 {
+        compatible         = "bridgetek,ft800";
+        reg                = <0>;
+        spi-max-frequency  = <10000000>; /* 10 MHz */
+        interrupt-parent   = <&gpio1>;
+        interrupts         = <28 IRQ_TYPE_EDGE_FALLING>;
+        reset-gpios        = <&gpio1 16 GPIO_ACTIVE_LOW>;
+    };
+};
+
+&i2c1 {
+    	status           = "okay";
+    	pinctrl-names    = "default";
+    	pinctrl-0        = <&i2c1_pins>;
+    	clock-frequency  = <100000>;
+    	#address-cells   = <1>;
+    	#size-cells      = <0>;
+};
+
+&i2c0 {
+    	tps: tps@24 {
+        compatible                   = "ti,tps65217";
+        reg                          = <0x24>;
+        interrupt-parent            = <&intc>; /* PMIC IRQ */
+        interrupts                   = <7>;
+        ti,pmic-shutdown-controller;
+    };
+};
+
+&ocp {
+    	rtc_ds1302_gpio: rtc@0 {
+        compatible      = "maxim,ds1302-gpio";
+        pinctrl-names   = "default";
+        pinctrl-0       = <&ds1302_pins>;
+        ce-gpios        = <&gpio2 2 GPIO_ACTIVE_HIGH>;
+        sclk-gpios      = <&gpio2 3 GPIO_ACTIVE_HIGH>;
+        io-gpios        = <&gpio2 4 GPIO_ACTIVE_HIGH>;
+        status          = "okay";
+    };
+};
+
+&uart5 {
+    	status           = "okay";
+    	pinctrl-names    = "default";
+    	pinctrl-0        = <&bb_uart5_pins>;
+};
+
-- 
2.43.0

